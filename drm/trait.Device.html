<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This trait should be implemented by any object that acts as a DRM device. It is a prerequisite for using any DRM functionality."><meta name="keywords" content="rust, rustlang, rust-lang, Device"><title>Device in drm - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><script defer src="../main.js"></script>
    <noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../drm/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../drm/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Device</a></h2><div class="sidebar-elems"><div class="block items"><h3 class="sidebar-title"><a href="#provided-methods">Provided Methods</a></h3><div class="sidebar-links"><a href="#method.acquire_master_lock">acquire_master_lock</a><a href="#method.authenticate_auth_token">authenticate_auth_token</a><a href="#method.authenticated">authenticated</a><a href="#method.generate_auth_token">generate_auth_token</a><a href="#method.get_bus_id">get_bus_id</a><a href="#method.get_driver">get_driver</a><a href="#method.get_driver_capability">get_driver_capability</a><a href="#method.release_master_lock">release_master_lock</a><a href="#method.set_client_capability">set_client_capability</a></div><h3 class="sidebar-title"><a href="#implementors">Implementors</a></h3></div><h2 class="location"><a href="index.html">In drm</a></h2><div id="sidebar-vars" data-name="Device" data-ty="trait" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../drm/index.html"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></a><nav class="sub"><div class="theme-picker hidden"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="22" height="22" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Trait <a href="index.html">drm</a>::<wbr><a class="trait" href="#">Device</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../src/drm/lib.rs.html#96-212">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><div class="docblock item-decl"><pre class="rust trait"><code>pub trait Device: <a class="trait" href="https://doc.rust-lang.org/nightly/std/os/fd/raw/trait.AsRawFd.html" title="trait std::os::fd::raw::AsRawFd">AsRawFd</a> {
    fn <a href="#method.acquire_master_lock" class="fnname">acquire_master_lock</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="enum" href="enum.SystemError.html" title="enum drm::SystemError">SystemError</a>&gt; { ... }
<div class="item-spacer"></div>    fn <a href="#method.release_master_lock" class="fnname">release_master_lock</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="enum" href="enum.SystemError.html" title="enum drm::SystemError">SystemError</a>&gt; { ... }
<div class="item-spacer"></div>    fn <a href="#method.generate_auth_token" class="fnname">generate_auth_token</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.AuthToken.html" title="struct drm::AuthToken">AuthToken</a>, <a class="enum" href="enum.SystemError.html" title="enum drm::SystemError">SystemError</a>&gt; { ... }
<div class="item-spacer"></div>    fn <a href="#method.authenticate_auth_token" class="fnname">authenticate_auth_token</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token: <a class="struct" href="struct.AuthToken.html" title="struct drm::AuthToken">AuthToken</a><br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="enum" href="enum.SystemError.html" title="enum drm::SystemError">SystemError</a>&gt; { ... }
<div class="item-spacer"></div>    fn <a href="#method.set_client_capability" class="fnname">set_client_capability</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cap: <a class="enum" href="enum.ClientCapability.html" title="enum drm::ClientCapability">ClientCapability</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enable: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a><br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="enum" href="enum.SystemError.html" title="enum drm::SystemError">SystemError</a>&gt; { ... }
<div class="item-spacer"></div>    fn <a href="#method.get_bus_id" class="fnname">get_bus_id</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.BusID.html" title="struct drm::BusID">BusID</a>, <a class="enum" href="enum.SystemError.html" title="enum drm::SystemError">SystemError</a>&gt; { ... }
<div class="item-spacer"></div>    fn <a href="#method.authenticated" class="fnname">authenticated</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a>, <a class="enum" href="enum.SystemError.html" title="enum drm::SystemError">SystemError</a>&gt; { ... }
<div class="item-spacer"></div>    fn <a href="#method.get_driver_capability" class="fnname">get_driver_capability</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cap: <a class="enum" href="enum.DriverCapability.html" title="enum drm::DriverCapability">DriverCapability</a><br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>, <a class="enum" href="enum.SystemError.html" title="enum drm::SystemError">SystemError</a>&gt; { ... }
<div class="item-spacer"></div>    fn <a href="#method.get_driver" class="fnname">get_driver</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.Driver.html" title="struct drm::Driver">Driver</a>, <a class="enum" href="enum.SystemError.html" title="enum drm::SystemError">SystemError</a>&gt; { ... }
}</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This trait should be implemented by any object that acts as a DRM device. It
is a prerequisite for using any DRM functionality.</p>
<p>This crate does not provide a concrete device object due to the various ways
it can be implemented. The user of this crate is expected to implement it
themselves and derive this trait as necessary. The example below
demonstrates how to do this using a small wrapper.</p>
<h2 id="example" class="section-header"><a href="#example">Example</a></h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">drm</span>;

<span class="kw">use</span> <span class="ident">drm::Device</span>;

<span class="kw">use</span> <span class="ident">std::fs::File</span>;
<span class="kw">use</span> <span class="ident">std::fs::OpenOptions</span>;

<span class="kw">use</span> <span class="ident">std::os::unix::io::RawFd</span>;
<span class="kw">use</span> <span class="ident">std::os::unix::io::AsRawFd</span>;

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>)]</span>
<span class="doccomment">/// A simple wrapper for a device node.</span>
<span class="kw">struct</span> <span class="ident">Card</span>(<span class="ident">File</span>);

<span class="doccomment">/// Implementing [`AsRawFd`] is a prerequisite to implementing the traits found</span>
<span class="doccomment">/// in this crate. Here, we are just calling [`File::as_raw_fd()`] on the inner</span>
<span class="doccomment">/// [`File`].</span>
<span class="kw">impl</span> <span class="ident">AsRawFd</span> <span class="kw">for</span> <span class="ident">Card</span> {
    <span class="kw">fn</span> <span class="ident">as_raw_fd</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="ident">RawFd</span> {
        <span class="self">self</span>.<span class="number">0</span>.<span class="ident">as_raw_fd</span>()
    }
}

<span class="doccomment">/// With [`AsRawFd`] implemented, we can now implement [`drm::Device`].</span>
<span class="kw">impl</span> <span class="ident">Device</span> <span class="kw">for</span> <span class="ident">Card</span> {}

<span class="kw">impl</span> <span class="ident">Card</span> {
    <span class="doccomment">/// Simple helper method for opening a [`Card`].</span>
    <span class="kw">fn</span> <span class="ident">open</span>() -&gt; <span class="self">Self</span> {
        <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">options</span> <span class="op">=</span> <span class="ident">OpenOptions::new</span>();
        <span class="ident">options</span>.<span class="ident">read</span>(<span class="bool-val">true</span>);
        <span class="ident">options</span>.<span class="ident">write</span>(<span class="bool-val">true</span>);

        <span class="comment">// The normal location of the primary device node on Linux</span>
        <span class="ident">Card</span>(<span class="ident">options</span>.<span class="ident">open</span>(<span class="string">&quot;/dev/dri/card0&quot;</span>).<span class="ident">unwrap</span>())
    }
}</code></pre></div>
</div></details><h2 id="provided-methods" class="small-section-header">Provided methods<a href="#provided-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="method.acquire_master_lock" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/drm/lib.rs.html#107-110">source</a></div><h4 class="code-header">fn <a href="#method.acquire_master_lock" class="fnname">acquire_master_lock</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="enum" href="enum.SystemError.html" title="enum drm::SystemError">SystemError</a>&gt;</h4></div></summary><div class="docblock"><p>Acquires the DRM Master lock for this process.</p>
<h5 id="notes" class="section-header"><a href="#notes">Notes</a></h5>
<p>Acquiring the DRM Master is done automatically when the primary device
node is opened. If you opened the primary device node and did not
acquire the lock, another process likely has the lock.</p>
<p>This function is only available to processes with CAP_SYS_ADMIN
privileges (usually as root)</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="method.release_master_lock" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/drm/lib.rs.html#113-116">source</a></div><h4 class="code-header">fn <a href="#method.release_master_lock" class="fnname">release_master_lock</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="enum" href="enum.SystemError.html" title="enum drm::SystemError">SystemError</a>&gt;</h4></div></summary><div class="docblock"><p>Releases the DRM Master lock for another process to use.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="method.generate_auth_token" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/drm/lib.rs.html#120-123">source</a></div><h4 class="code-header">fn <a href="#method.generate_auth_token" class="fnname">generate_auth_token</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.AuthToken.html" title="struct drm::AuthToken">AuthToken</a>, <a class="enum" href="enum.SystemError.html" title="enum drm::SystemError">SystemError</a>&gt;</h4></div></summary><div class="item-info"><div class="stab deprecated"><span class="emoji">👎</span> Deprecated: <p>Consider opening a render node instead.</p>
</div></div><div class="docblock"><p>Generates an <a href="struct.AuthToken.html" title="AuthToken"><code>AuthToken</code></a> for this process.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="method.authenticate_auth_token" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/drm/lib.rs.html#126-129">source</a></div><h4 class="code-header">fn <a href="#method.authenticate_auth_token" class="fnname">authenticate_auth_token</a>(&amp;self, token: <a class="struct" href="struct.AuthToken.html" title="struct drm::AuthToken">AuthToken</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="enum" href="enum.SystemError.html" title="enum drm::SystemError">SystemError</a>&gt;</h4></div></summary><div class="docblock"><p>Authenticates an <a href="struct.AuthToken.html" title="AuthToken"><code>AuthToken</code></a> from another process.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="method.set_client_capability" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/drm/lib.rs.html#133-140">source</a></div><h4 class="code-header">fn <a href="#method.set_client_capability" class="fnname">set_client_capability</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;cap: <a class="enum" href="enum.ClientCapability.html" title="enum drm::ClientCapability">ClientCapability</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;enable: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a><br>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="enum" href="enum.SystemError.html" title="enum drm::SystemError">SystemError</a>&gt;</h4></div></summary><div class="docblock"><p>Requests the driver to expose or hide certain capabilities. See
<a href="enum.ClientCapability.html" title="ClientCapability"><code>ClientCapability</code></a> for more information.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="method.get_bus_id" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/drm/lib.rs.html#143-158">source</a></div><h4 class="code-header">fn <a href="#method.get_bus_id" class="fnname">get_bus_id</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.BusID.html" title="struct drm::BusID">BusID</a>, <a class="enum" href="enum.SystemError.html" title="enum drm::SystemError">SystemError</a>&gt;</h4></div></summary><div class="docblock"><p>Gets the <a href="struct.BusID.html" title="BusID"><code>BusID</code></a> of this device.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="method.authenticated" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/drm/lib.rs.html#162-165">source</a></div><h4 class="code-header">fn <a href="#method.authenticated" class="fnname">authenticated</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a>, <a class="enum" href="enum.SystemError.html" title="enum drm::SystemError">SystemError</a>&gt;</h4></div></summary><div class="docblock"><p>Check to see if our <a href="struct.AuthToken.html" title="AuthToken"><code>AuthToken</code></a> has been authenticated
by the DRM Master</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="method.get_driver_capability" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/drm/lib.rs.html#168-171">source</a></div><h4 class="code-header">fn <a href="#method.get_driver_capability" class="fnname">get_driver_capability</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;cap: <a class="enum" href="enum.DriverCapability.html" title="enum drm::DriverCapability">DriverCapability</a><br>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>, <a class="enum" href="enum.SystemError.html" title="enum drm::SystemError">SystemError</a>&gt;</h4></div></summary><div class="docblock"><p>Gets the value of a capability.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="method.get_driver" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/drm/lib.rs.html#176-211">source</a></div><h4 class="code-header">fn <a href="#method.get_driver" class="fnname">get_driver</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="struct.Driver.html" title="struct drm::Driver">Driver</a>, <a class="enum" href="enum.SystemError.html" title="enum drm::SystemError">SystemError</a>&gt;</h4></div></summary><div class="docblock"><h5 id="possible-errors" class="section-header"><a href="#possible-errors">Possible errors:</a></h5>
<ul>
<li><a href="enum.SystemError.html#variant.MemoryFault" title="SystemError::MemoryFault"><code>SystemError::MemoryFault</code></a>: Kernel could not copy fields into userspace</li>
</ul>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor"></a></h2><div class="item-list" id="implementors-list"></div><script type="text/javascript" src="../implementors/drm/trait.Device.js" async></script></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="drm" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.60.0-nightly (88fb06a1f 2022-02-05)" ></div>
</body></html>